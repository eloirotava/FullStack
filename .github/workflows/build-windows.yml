# Nome do Workflow (para aparecer no GitHub)
name: Build Windows EXE

# Gatilho: Quando este workflow deve rodar?
on:
  # Opção 1: Rodar manualmente (clicando no botão "Run workflow" no GitHub)
  workflow_dispatch:

  # Opção 2: Rodar automaticamente sempre que houver um push na 'main'
  # push:
  #   branches: [ "main" ]

jobs:
  # O nome do "trabalho"
  build-windows:
    # A "Fábrica": Uma máquina Windows virtual novinha
    runs-on: windows-latest

    steps:
      # Passo 1: Obter o código-fonte (o seu 'app.py', 'requirements.txt', etc.)
      - name: Checkout do código
        uses: actions/checkout@v4

      # Passo 2: Configurar o Python (a máquina Windows já vem com ele)
      - name: Setup do Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12' # Usar a mesma versão do seu Dockerfile
          cache: 'pip' # Faz cache do pip para ser mais rápido

      # Passo 3: Instalar as dependências (Flask, SQLAlchemy, PyInstaller)
      - name: Instalar dependências
        run: |
          pip install -r requirements.txt
      
      # Passo 4: Rodar o PyInstaller (A "Mágica")
      # É o mesmo comando do seu Dockerfile, mas em formato Windows
      - name: Construir o executável com PyInstaller
        run: |
          pyinstaller --onefile `
            --add-data "templates;templates" `
            --add-data "static;static" `
            --name kanban-windows app.py
      
      # Passo 5: A "Fuga" (Disponibilizar o .exe para download)
      - name: Upload do Artefato (o .exe)
        uses: actions/upload-artifact@v4
        with:
          # O nome do "pacote" que vai aparecer nos downloads do GitHub
          name: kanban-windows-exe
          # O ficheiro que ele deve apanhar (o PyInstaller coloca em 'dist/')
          path: dist/kanban-windows.exe
